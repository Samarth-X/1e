<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Mirror Maze</title>
  <style>
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      height: 100vh;
      margin: 0;
      background: #222;
      color: #fff;
      font-family: sans-serif;
      overscroll-behavior: contain;
      touch-action: none;
    }
    .canvases {
      display: flex;
      gap: 10px;
    }
    canvas {
      background: #111;
      border: 2px solid #555;
      touch-action: none;
    }
    .controls {
      margin-top: 10px;
      display: grid;
      grid-template-areas:
        ". up ."
        "left . right"
        ". down .";
      grid-gap: 5px;
    }
    .controls button {
      width: 50px;
      height: 50px;
      font-size: 1.2rem;
      border: none;
      border-radius: 4px;
      background: #444;
      color: #fff;
      touch-action: none;
    }
    #up { grid-area: up; }
    #down { grid-area: down; }
    #left { grid-area: left; }
    #right { grid-area: right; }
    button.action {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
      border-radius: 4px;
      border: none;
      background: #444;
      color: #fff;
      touch-action: none;
    }
    #message {
      margin-top: 10px;
      font-size: 1.1rem;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Mirror Maze - Level <span id="level">1</span></h1>
  <div class="canvases">
    <canvas id="maze1"></canvas>
    <canvas id="maze2"></canvas>
  </div>
  <div class="controls">
    <button id="up">▲</button>
    <button id="left">◀</button>
    <button id="right">▶</button>
    <button id="down">▼</button>
  </div>
  <div>
    <button id="nextBtn" class="action" style="display:none;">Next Level</button>
    <button id="restartBtn" class="action" style="display:none;">Restart</button>
  </div>
  <div id="message">Use arrows or swipe to move.</div>

  <script>
    let currentLevel = 1;
    const maxLevels = 20;
    const cellSize = 20;
    let maze, gridSize, player, exit;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
    function generateMaze(rows, cols) {
      const m = Array.from({ length: rows }, () => Array(cols).fill(1));
      function carve(x, y) {
        m[y][x] = 0;
        const dirs = [[2,0],[-2,0],[0,2],[0,-2]];
        shuffle(dirs);
        dirs.forEach(([dx, dy]) => {
          const nx = x + dx, ny = y + dy;
          if (ny > 0 && ny < rows - 1 && nx > 0 && nx < cols - 1 && m[ny][nx] === 1) {
            m[y + dy/2][x + dx/2] = 0;
            carve(nx, ny);
          }
        });
      }
      carve(1, 1);
      return m;
    }
    function startLevel() {
      gridSize = 15;
      maze = generateMaze(gridSize, gridSize);
      player = { x: 1, y: 1 };
      exit = { x: gridSize - 2, y: gridSize - 2 };

      document.getElementById('level').textContent = currentLevel;
      document.getElementById('message').textContent = 'Use arrows or swipe to move.';
      document.getElementById('nextBtn').style.display = 'none';
      document.getElementById('restartBtn').style.display = 'none';

      const [c1, c2] = [document.getElementById('maze1'), document.getElementById('maze2')];
      [c1, c2].forEach(c => {
        c.width = gridSize * cellSize;
        c.height = gridSize * cellSize;
      });
      render();
    }
    function drawMaze(ctx, mirror = false) {
      for (let y = 0; y < gridSize; y++) {
        for (let x = 0; x < gridSize; x++) {
          const cell = maze[y][x];
          const dx = mirror ? gridSize - 1 - x : x;
          ctx.fillStyle = cell ? '#555' : '#222';
          ctx.fillRect(dx * cellSize, y * cellSize, cellSize, cellSize);
          ctx.strokeStyle = '#444';
          ctx.strokeRect(dx * cellSize, y * cellSize, cellSize, cellSize);
        }
      }
    }
    function drawPlayer() {
      const c1 = document.getElementById('maze1').getContext('2d');
      const c2 = document.getElementById('maze2').getContext('2d');
      [c1, c2].forEach(ctx => ctx.clearRect(0,0,gridSize*cellSize,gridSize*cellSize));
      drawMaze(c1);
      drawMaze(c2, true);
      c1.fillStyle = c2.fillStyle = '#0f0';
      c1.fillRect(player.x*cellSize+4,player.y*cellSize+4,cellSize-8,cellSize-8);
      const mx = gridSize - 1 - player.x;
      c2.fillRect(mx*cellSize+4,player.y*cellSize+4,cellSize-8,cellSize-8);
    }
    function render() { drawPlayer(); }
    function tryMove(dx, dy) {
      const nx = player.x + dx, ny = player.y + dy;
      const mx = gridSize - 1 - nx;
      if (ny>=0 && ny<gridSize && nx>=0 && nx<gridSize && maze[ny][nx]===0 && maze[ny][mx]===0) {
        player.x=nx; player.y=ny; drawPlayer();
        if (nx===exit.x && ny===exit.y) winLevel();
      }
    }
    function winLevel() {
      const msg = document.getElementById('message');
      if (currentLevel < maxLevels) {
        msg.textContent = `Level ${currentLevel} complete! Tap Next.`;
        document.getElementById('nextBtn').style.display = 'inline-block';
      } else {
        msg.textContent = 'All levels done!';
        document.getElementById('restartBtn').style.display = 'inline-block';
      }
    }
    // Controls
    ['up','down','left','right'].forEach(dir => {
      document.getElementById(dir).addEventListener('touchstart',e=>{e.preventDefault();
        const moves = { up:[0,-1], down:[0,1], left:[-1,0], right:[1,0] };
        tryMove(...moves[dir]);
      });
    });
    document.getElementById('nextBtn').addEventListener('click',()=>{currentLevel++;startLevel();});
    document.getElementById('restartBtn').addEventListener('click',()=>{currentLevel=1;startLevel();});
    // Keyboard
    window.addEventListener('keydown',e=>{
      const keys={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};
      if(keys[e.key]){e.preventDefault(); tryMove(...keys[e.key]);}
    });
    // Swipe
    let sx, sy;
    document.addEventListener('touchstart',e=>{sx=e.changedTouches[0].screenX; sy=e.changedTouches[0].screenY;});
    document.addEventListener('touchend',e=>{
      const ex=e.changedTouches[0].screenX, ey=e.changedTouches[0].screenY;
      const dx=ex-sx, dy=ey-sy;
      if(Math.abs(dx)>Math.abs(dy)){ if(dx>30) tryMove(1,0); else if(dx<-30) tryMove(-1,0);
      } else { if(dy>30) tryMove(0,1); else if(dy<-30) tryMove(0,-1); }
    },{passive:false});
    // Prevent scroll
    document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
    startLevel();
  </script>
</body>
</html>
